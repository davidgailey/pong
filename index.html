<!DOCTYPE html>
<html>
<head>
	<title>Pong!!!</title>
</head>
<body>

<canvas id="pongCanvas"
	width="800"
	height="600">
</canvas>

<script type="text/javascript">
	var canvas, canvasContext;
	var framesPerSecond = 30;

	// ball options
	var ballX = 50;
	var ballY = 50;
	var ballSpeedX = 10;
	var ballSpeedY = 4;

	// paddle options
	var paddle1Y = 250;
	var paddle2Y = 250;
	const paddleHeight = 100;
	const paddleWidth = 10;

	// score variables
	var player1Score = 0;
	var player2Score = 0;

	function moveEverything(){

		computerMovement();

		ballX += ballSpeedX;
		ballY += ballSpeedY;

		// handle reflection off left side paddle
		if (ballX < 0) {
			// if ball hits where paddle is, reverse direction
			if(ballY > paddle1Y && ballY < paddle1Y + paddleHeight){
				ballSpeedX = -ballSpeedX;
			}else{
				ballReset();
				player2Score += 1;
			}
		}

		// handle reflection off right side paddle
		if (ballX > canvas.width) {
			// if ball hits where paddle is, reverse direction
			if(ballY > paddle2Y && ballY < paddle2Y + paddleHeight){
				ballSpeedX = -ballSpeedX;
			}else{
				ballReset();
				player1Score += 1;
			}
		}

		// bounce ball off top and bottom
		if (ballY > canvas.height || ballY < 0) {
			ballSpeedY = -ballSpeedY;
		}
		
	}
	
	function drawEverything(){
		// draw background
		drawColorRect(0,0,canvas.width,canvas.height,'black');

		// draw player paddle
		drawColorRect(0,paddle1Y,paddleWidth,paddleHeight,'white');

		// draw cpu paddle
		drawColorRect(canvas.width - paddleWidth,paddle2Y,paddleWidth,paddleHeight,'white');

		// draw "ball"
		drawColorCircle(ballX,ballY,8,'white');

		// draw score
		canvasContext.font = '48px sans-serif';
		canvasContext.fillText(player1Score, 100, 100);
		canvasContext.fillText(player2Score, canvas.width -100, 100);


	}

	function drawColorRect (x,y,width,height,color){
		canvasContext.fillStyle = color;
		canvasContext.fillRect(x,y,width,height);
	}

	function drawColorCircle (centerX,centerY,radius,color) {
		canvasContext.fillStyle = color;
		canvasContext.beginPath();
		canvasContext.arc(centerX,centerY,radius, 0,Math.PI*2,true);
		canvasContext.fill();
	}

	function calculateMousePos(event){
		let rect = canvas.getBoundingClientRect();
		let root = document.documentElement;
		let mouseX = event.clientX - rect.left - root.scrollLeft;
		let mouseY = event.clientY - rect.top - root.scrollTop;

		return {x:mouseX,y:mouseY}
	}

	function ballReset(){
		// change ball direction to other player
		ballSpeedX = -ballSpeedX

		// center ball
		ballX = canvas.width/2;
		ballY = canvas.height/2;
	}

	function computerMovement(){
		let paddle2YCenter = paddle2Y + (paddleHeight/2)

		if(paddle2YCenter < ballY - 35){
			paddle2Y += 6;
		}else if(paddle2YCenter > ballY + 35){
			paddle2Y -= 6;
		}
	}

	window.onload = function() {
		canvas = document.getElementById('pongCanvas');
		canvasContext = canvas.getContext('2d');

		window.setInterval(function(){
			moveEverything();
			drawEverything();
		}, 1000/framesPerSecond);

		canvas.addEventListener('mousemove',
			function(event){
				let mousePos = calculateMousePos(event);
				paddle1Y = mousePos.y - (paddleHeight/2);
			});
	}


</script>

</body>
</html>